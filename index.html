<!DOCTYPE html>
<html lang="es">
<head>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üÉè</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üÉè</text></svg>">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Poker Pro - Preflop Trainer</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="PokerTrainer">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#070707">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { height: 100dvh; width: 100vw; overflow: hidden; background-color: #070707; color: white; font-family: ui-sans-serif, system-ui, sans-serif; }
        .main-app { display: grid; grid-template-rows: 1fr auto 165px; height: 100dvh; }
        .table-container { position: relative; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .btn-new-hand { position: absolute; top: 20px; left: 20px; z-index: 100; background: rgba(40, 40, 40, 0.9); border: 1px solid #444; color: #fbbf24; padding: 8px 14px; border-radius: 8px; font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .stats-panel { position: absolute; top: 20px; right: 20px; z-index: 100; background: rgba(20, 20, 20, 0.8); border: 1px solid #333; padding: 6px 12px; border-radius: 8px; font-family: monospace; text-align: right; min-width: 110px; }
        .stat-line { font-size: 10px; font-weight: 800; line-height: 1.2; display: flex; justify-content: space-between; gap: 10px; }
        .stat-val { color: #fbbf24; }
        .stat-actual { color: #fff; }
        #feedback-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000; padding: 15px 30px; border-radius: 15px; font-weight: 900; font-size: 24px; text-transform: uppercase; display: none; pointer-events: none; box-shadow: 0 0 30px rgba(0,0,0,0.8); }
        .poker-table { width: 100%; height: 85%; max-width: 440px; background: radial-gradient(circle at center, #1e4d30 0%, #0a1f14 100%); border: 8px solid #3d2b1f; border-radius: 150px; position: relative; box-shadow: inset 0 0 60px rgba(0,0,0,0.8); z-index: 1; }
        .dealer-button { position: absolute; width: 22px; height: 22px; background: white; color: black; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 900; box-shadow: 0 2px 4px rgba(0,0,0,0.5); border: 1px solid #999; z-index: 70; display: none; }
        .pot-label { position: absolute; top: 32%; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.7); padding: 2px 12px; border-radius: 20px; font-size: 12px; font-weight: 800; color: #fbbf24; border: 1px solid rgba(251,191,36,0.3); z-index: 50; }
        .card { width: 42px; height: 58px; border-radius: 5px; display: flex; flex-direction: column; justify-content: space-between; padding: 3px 4px; font-weight: 900; font-size: 18px; line-height: 1; box-shadow: 0 3px 6px rgba(0,0,0,0.4); }
        .card-suit { align-self: flex-end; font-size: 22px; }
        .spades { background-color: #1a1a1a; color: #fff; }
        .hearts { background-color: #e11d48; color: #fff; }
        .clubs { background-color: #166534; color: #fff; }
        .diamonds { background-color: #1e40af; color: #fff; }
        .card-back-group { display: none; gap: -12px; position: absolute; top: -12px; z-index: 20; }
        .card-back { width: 28px; height: 40px; background: linear-gradient(135deg, #8b0000 0%, #4a0000 100%); border: 1.5px solid #c0c0c0; border-radius: 3px; }
        .player-pod { position: absolute; width: 85px; display: flex; flex-direction: column; align-items: center; z-index: 10; opacity: 0.3; filter: grayscale(1); transition: all 0.3s ease; }
        .avatar-container { position: relative; width: 55px; height: 55px; }
        .avatar-frame { width: 100%; height: 100%; border-radius: 50%; background: #151515; border: 2px solid #444; overflow: hidden; }
        .avatar-img { width: 100%; height: 100%; object-fit: cover; }
        .name-plate { background: rgba(0,0,0,0.9); border: 1px solid #333; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 800; margin-top: -8px; z-index: 30; text-align: center; width: 75px; }
        .stack-val { font-size: 11px; font-weight: 800; color: #22c55e; margin-top: 2px; }
        .bet-chips { position: absolute; background: rgba(0,0,0,0.8); border: 1px solid #fbbf24; color: white; padding: 1px 6px; border-radius: 10px; font-size: 10px; font-weight: 900; z-index: 60; min-width: 40px; text-align: center; display: none; }
        .v-seat-0 { bottom: -15px; left: 50%; transform: translateX(-50%); } 
        .v-seat-1 { bottom: 25%; left: -5px; }
        .v-seat-2 { top: 20%; left: -5px; }
        .v-seat-3 { top: -20px; left: 50%; transform: translateX(-50%); }
        .v-seat-4 { top: 20%; right: -5px; }
        .v-seat-5 { bottom: 25%; right: -5px; }
        .d-pos-0 { bottom: 18%; left: 62%; }
        .d-pos-1 { bottom: 42%; left: 20%; }
        .d-pos-2 { top: 38%; left: 20%; }
        .d-pos-3 { top: 12%; left: 40%; }
        .d-pos-4 { top: 38%; right: 20%; }
        .d-pos-5 { bottom: 42%; right: 20%; }
        .v-bet-0 { bottom: 22%; left: 50%; transform: translateX(-50%); }
        .v-bet-1 { bottom: 25%; left: 75px; }
        .v-bet-2 { top: 25%; left: 75px; }
        .v-bet-3 { top: 15%; left: 50%; transform: translateX(-50%); }
        .v-bet-4 { top: 25%; right: 75px; }
        .v-bet-5 { bottom: 35%; right: 75px; }
        .hero-hand { display: flex; gap: 2px; position: absolute; bottom: 35px; z-index: 50; }
        .action-bar { background: #111; padding: 15px 12px; display: flex; flex-direction: column; gap: 12px; }
        .main-btns { display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 10px; }
        .btn-p { height: 60px; border-radius: 12px; font-weight: 800; text-transform: uppercase; color: white; border: none; }
        .btn-allin-red { background: #b91c1c !important; border-bottom: 4px solid #7f1d1d !important; }
        .btn-call-blue { background: #2563eb !important; border-bottom: 4px solid #1e40af !important; }
        .active-player { opacity: 1 !important; filter: grayscale(0) !important; }
        .is-hero-frame { border: 2px solid #fbbf24 !important; }
        .phase-selection { display: flex; justify-content: center; gap: 12px; padding-bottom: 15px; background: #070707; }
        .btn-phase { background: #1a1a1a; border: 1px solid #333; color: #fbbf24; padding: 8px 20px; border-radius: 20px; font-size: 12px; font-weight: 800; text-transform: uppercase; min-width: 110px; }
        .btn-phase.active { background: #fbbf24; color: #000; }
    </style>
</head>
<body>

<div class="main-app">
    <div class="table-container">
        <div id="feedback-overlay"></div>
        <button class="btn-new-hand" onclick="generateScenario()">NUEVA MANO</button>
        <div class="stats-panel">
            <div class="stat-line"><span>RECORD:</span> <span id="record-val" class="stat-val">0</span></div>
            <div class="stat-line"><span>ACTUAL:</span> <span id="actual-val" class="stat-actual">0</span></div>
        </div>
        <div class="poker-table">
            <div id="pot-display" class="pot-label">POT: 0 BB</div>
            <div id="dealer-btn" class="dealer-button">D</div>
            <div id="pod-0" class="player-pod v-seat-0"><div id="hero-cards" class="hero-hand"></div><div class="avatar-container"><div class="avatar-frame"><img src="https://i.pravatar.cc/150?u=hero_poker_1" class="avatar-img"></div></div><div class="name-plate">HERO</div><div class="stack-val">100 BB</div></div>
            <div id="bet-0" class="bet-chips v-bet-0"></div>
            <div id="pod-1" class="player-pod v-seat-1"><div class="card-back-group"><div class="card-back"></div><div class="card-back"></div></div><div class="avatar-container"><div class="avatar-frame"><img src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=150&h=150&fit=crop" class="avatar-img"></div></div><div class="name-plate">UTG</div><div class="stack-val">100 BB</div></div>
            <div id="bet-1" class="bet-chips v-bet-1"></div>
            <div id="pod-2" class="player-pod v-seat-2"><div class="card-back-group"><div class="card-back"></div><div class="card-back"></div></div><div class="avatar-container"><div class="avatar-frame"><img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=150&h=150&fit=crop" class="avatar-img"></div></div><div class="name-plate">MP</div><div class="stack-val">100 BB</div></div>
            <div id="bet-2" class="bet-chips v-bet-2"></div>
            <div id="pod-3" class="player-pod v-seat-3"><div class="card-back-group"><div class="card-back"></div><div class="card-back"></div></div><div class="avatar-container"><div class="avatar-frame"><img src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=150&h=150&fit=crop" class="avatar-img"></div></div><div class="name-plate">CO</div><div class="stack-val">100 BB</div></div>
            <div id="bet-3" class="bet-chips v-bet-3"></div>
            <div id="pod-4" class="player-pod v-seat-4"><div class="card-back-group"><div class="card-back"></div><div class="card-back"></div></div><div class="avatar-container"><div class="avatar-frame"><img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop" class="avatar-img"></div></div><div class="name-plate">BU</div><div class="stack-val">100 BB</div></div>
            <div id="bet-4" class="bet-chips v-bet-4"></div>
            <div id="pod-5" class="player-pod v-seat-5"><div class="card-back-group"><div class="card-back"></div><div class="card-back"></div></div><div class="avatar-container"><div class="avatar-frame"><img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=150&h=150&fit=crop" class="avatar-img"></div></div><div class="name-plate">SB</div><div class="stack-val">100 BB</div></div>
            <div id="bet-5" class="bet-chips v-bet-5"></div>
        </div>
    </div>
    <div class="phase-selection">
        <button class="btn-phase active">PREFLOP</button>
        <button class="btn-phase" onclick="goToPostflop()">POSTFLOP</button>
    </div>
    <div class="action-bar"><div id="button-container" class="main-btns"></div></div>
</div>

<script>
    const posNames = ['UTG', 'MP', 'CO', 'BU', 'SB', 'BB'];
    const suits = [
        { name: 'spades', icon: '‚ô†' },
        { name: 'hearts', icon: '‚ô•' },
        { name: 'clubs', icon: '‚ô£' },
        { name: 'diamonds', icon: '‚ô¶' }
    ];

    const range = [
        {id: 'AA', v1: 'A', v2: 'A', type: 'pair'},
        {id: 'KK', v1: 'K', v2: 'K', type: 'pair'},
        {id: 'QQ', v1: 'Q', v2: 'Q', type: 'pair'},
        {id: 'AKs', v1: 'A', v2: 'K', type: 'suited'},
        {id: 'AKo', v1: 'A', v2: 'K', type: 'offsuited'},
        {id: 'JJ', v1: 'J', v2: 'J', type: 'pair'},
        {id: 'AQs', v1: 'A', v2: 'Q', type: 'suited'}
    ];

    const manualScenarios = [
        { id: 'A5s_4BET', hand: {id: 'A5s', v1: 'A', v2: '5', s1: 'hearts', s2: 'hearts', i1: '‚ô•', i2: '‚ô•'}, heroPos: 3, villanoPos: 2, hBet: 7.5, vBet: 24, buttons: [ { text: 'FOLD', color: 'bg-slate-700', isCorrect: true }, { text: 'ALL IN', color: 'btn-allin-red', isCorrect: false } ] },
        { id: 'KK_UTG_MP', hand: {id: 'KK', v1: 'K', v2: 'K', s1: 'diamonds', s2: 'hearts', i1: '‚ô¶', i2: '‚ô•'}, heroPos: 0, villanoPos: 1, hBet: 24, vBet: 100, buttons: [ { text: 'FOLD', color: 'bg-slate-700', isCorrect: true }, { text: 'ALL IN', color: 'btn-allin-red', isCorrect: false } ] },
        { id: 'AA_TRAP', hand: {id: 'AA', v1: 'A', v2: 'A', s1: 'spades', s2: 'hearts', i1: '‚ô†', i2: '‚ô•'}, heroPos: 4, villanoPos: 5, hBet: 2, vBet: 7.5, buttons: [ { text: 'FOLD', color: 'bg-slate-700', isCorrect: false }, { text: 'CALL', color: 'btn-call-blue', isCorrect: false }, { text: '4BET', color: 'btn-allin-red', isCorrect: true } ] },
        { id: '', hand: {id: '', v1: 'A', v2: 'J', s1: 'spades', s2: 'hearts', i1: '‚ô†', i2: '‚ô•'}, heroPos: 2, villanoPos: 0, hBet: 7.5, vBet: 24, buttons: [ { text: 'FOLD', color: 'bg-slate-700', isCorrect: true }, { text: 'CALL', color: 'btn-call-blue', isCorrect: false }, { text: '4BET', color: 'btn-allin-red', isCorrect: false } ] },
        { id: '', hand: {id: '', v1: '9', v2: '8', s1: 'hearts', s2: 'hearts', i1: '‚ô•', i2: '‚ô•'}, heroPos: 3, villanoPos: 2, hBet: 7.5, vBet: 24, buttons: [ { text: 'FOLD', color: 'bg-slate-700', isCorrect: true }, { text: 'CALL', color: 'btn-call-blue', isCorrect: false }, { text: 'ALL IN', color: 'btn-allin-red', isCorrect: false } ] },
        { id: '', hand: {id: '', v1: '9', v2: '8', s1: 'hearts', s2: 'hearts', i1: '‚ô•', i2: '‚ô•'}, heroPos: 3, villanoPos: 2, hBet: 0, vBet: 2.5, buttons: [ { text: 'FOLD', color: 'bg-slate-700', isCorrect: false }, { text: 'CALL', color: 'btn-call-blue', isCorrect: false }, { text: '3BET', color: 'btn-allin-red', isCorrect: true } ] },
        { id: '', hand: {id: '', v1: '6', v2: '6', s1: 'hearts', s2: 'spades', i1: '‚ô•', i2: '‚ô†'}, heroPos: 4, villanoPos: 3, hBet: 0, vBet: 2.5, buttons: [ { text: 'FOLD', color: 'bg-slate-700', isCorrect: false }, { text: 'CALL', color: 'btn-call-blue', isCorrect: true }, { text: '3BET', color: 'btn-allin-red', isCorrect: false } ] },
        { id: '', hand: {id: '', v1: 'K', v2: 'Q', s1: 'hearts', s2: 'spades', i1: '‚ô•', i2: '‚ô†'}, heroPos: 4, villanoPos: 3, hBet: 0, vBet: 2.5, buttons: [ { text: 'FOLD', color: 'bg-slate-700', isCorrect: false }, { text: 'CALL', color: 'btn-call-blue', isCorrect: false }, { text: '3BET', color: 'btn-allin-red', isCorrect: true } ] },
        { id: '', hand: {id: '', v1: 'K', v2: 'Q', s1: 'hearts', s2: 'spades', i1: '‚ô•', i2: '‚ô†'}, heroPos: 4, villanoPos: 2, hBet: 0, vBet: 2.5, buttons: [ { text: 'FOLD', color: 'bg-slate-700', isCorrect: false }, { text: 'CALL', color: 'btn-call-blue', isCorrect: false }, { text: '3BET', color: 'btn-allin-red', isCorrect: true } ] },
        { id: '', hand: {id: '', v1: '5', v2: '5', s1: 'hearts', s2: 'spades', i1: '‚ô•', i2: '‚ô†'}, heroPos: 4, villanoPos: 3, hBet: 0, vBet: 2.5, buttons: [ { text: 'FOLD', color: 'bg-slate-700', isCorrect: true }, { text: 'CALL', color: 'btn-call-blue', isCorrect: false }, { text: '3BET', color: 'btn-allin-red', isCorrect: false } ] },
        { id: '', hand: {id: '', v1: 'K', v2: '2', s1: 'hearts', s2: 'hearts', i1: '‚ô•', i2: '‚ô•'}, heroPos: 5, villanoPos: 4, hBet: 0, vBet: 2.5, buttons: [ { text: 'FOLD', color: 'bg-slate-700', isCorrect: false }, { text: 'CALL', color: 'btn-call-blue', isCorrect: true }, { text: '3BET', color: 'btn-allin-red', isCorrect: false } ] },
    ];

    let currentHand = null;
    let isVillanoNit = false;
    let villanoStackSize = 100;
    let scenarioAction = ""; 
    let activeManualButtons = null;
    let actualHands = 0;
    let recordHands = localStorage.getItem('poker_record_preflop') || 0;
    let currentHBet = 0;
    let currentVBet = 0;

    document.getElementById('record-val').innerText = recordHands;

    function getRandomPalos(hand) {
        let s1, s2;
        const shf = [...suits].sort(() => 0.5 - Math.random());
        if (hand.type === 'suited') { s1 = s2 = shf[0]; }
        else { s1 = shf[0]; s2 = shf[1]; }
        return { ...hand, s1: s1.name, i1: s1.icon, s2: s2.name, i2: s2.icon };
    }

    function renderButtons(mode) {
        const container = document.getElementById('button-container');
        container.innerHTML = "";
        if (Array.isArray(mode)) {
            activeManualButtons = mode;
            mode.forEach((btn, idx) => {
                const b = document.createElement('button');
                b.className = `btn-p ${btn.color}`;
                b.innerText = btn.text;
                b.onclick = () => checkDecision(idx);
                container.appendChild(b);
            });
        } else if (mode === '3BET_50') {
            activeManualButtons = null;
            container.innerHTML = `<button class="btn-p bg-slate-700" onclick="checkDecision('FOLD')">FOLD</button><button class="btn-p btn-call-blue" onclick="checkDecision('CALL')">CALL</button><button class="btn-p btn-allin-red" onclick="checkDecision('ALLIN')">ALL IN</button>`;
        } else {
            activeManualButtons = null;
            container.innerHTML = `<button class="btn-p bg-slate-700" onclick="checkDecision('FOLD')">FOLD</button><button class="btn-p btn-allin-red" onclick="checkDecision('ALLIN')">ALL IN</button>`;
        }
    }

    function checkDecision(input) {
        const overlay = document.getElementById('feedback-overlay');
        let isCorrect = false;
        
        if (activeManualButtons !== null) {
            isCorrect = activeManualButtons[input].isCorrect;
        } else {
            if (villanoStackSize === 100) {
                if (input === 'ALLIN') {
                    if (currentHand.id === 'AA') isCorrect = true;
                    else if (currentHand.id === 'KK') {
                        if (currentHBet === 24 && currentVBet === 100) isCorrect = false;
                        else if (currentVBet === 24 && isVillanoNit) isCorrect = false;
                        else isCorrect = true;
                    }
                    else if (currentHand.id === 'AKs') isCorrect = false; // REGLA: NUNCA ALL IN AKS
                }
                if (input === 'FOLD') {
                    if (['QQ', 'AKo', 'JJ', 'AQs'].includes(currentHand.id)) isCorrect = true;
                    else if (currentHand.id === 'AKs') isCorrect = true; // REGLA: SIEMPRE FOLD ANTE 4BET/PUSH
                    else if (currentHand.id === 'KK') {
                        if (currentHBet === 24 && currentVBet === 100) isCorrect = true;
                        else if (currentVBet === 24 && isVillanoNit) isCorrect = true;
                    }
                }
            } else { // LOGICA 50 BB (SE MANTIENE IGUAL)
                if (scenarioAction === "push") {
                    if (input === 'ALLIN') isCorrect = ['AA', 'KK', 'AKs'].includes(currentHand.id);
                    if (input === 'FOLD') isCorrect = ['QQ', 'JJ', 'AKo', 'AQs'].includes(currentHand.id);
                } else if (scenarioAction === "3bet") {
                    if (input === 'ALLIN') isCorrect = ['AA', 'KK', 'AKs'].includes(currentHand.id);
                    if (input === 'CALL') isCorrect = ['QQ', 'JJ', 'AKo', 'AQs'].includes(currentHand.id);
                }
            }
        }
        updateStats(isCorrect);
        overlay.innerText = isCorrect ? "CORRECTO" : "FALLASTE";
        overlay.style.backgroundColor = isCorrect ? "#16a34a" : "#dc2626";
        overlay.style.display = "block";
        setTimeout(() => { overlay.style.display = "none"; if(isCorrect) generateScenario(); }, 800);
    }

    function generateScenario() {
        isVillanoNit = false;
        activeManualButtons = null;
        document.querySelectorAll('.player-pod').forEach(p => { p.style.opacity = '0.3'; p.classList.remove('active-player'); p.querySelector('.avatar-frame').classList.remove('is-hero-frame'); });
        document.querySelectorAll('.card-back-group').forEach(c => c.style.display = 'none');
        document.querySelectorAll('.bet-chips').forEach(b => { b.style.display = 'none'; b.style.borderColor = '#fbbf24'; });
        
        if (manualScenarios.length > 0 && Math.random() < 0.4) {
            const s = manualScenarios[Math.floor(Math.random() * manualScenarios.length)];
            currentHand = s.hand; currentHBet = s.hBet; currentVBet = s.vBet; villanoStackSize = 100;
            setupUI(s.heroPos, s.villanoPos, s.hBet, s.vBet, 100);
            renderButtons(s.buttons);
        } else {
            // FRECUENCIA AUMENTADA PARA KK Y AKs (60% de probabilidad de ser una de estas dos)
            let baseHand;
            const randHand = Math.random();
            if (randHand < 0.10) baseHand = range.find(r => r.id === 'KK');
            else if (randHand < 0.20) baseHand = range.find(r => r.id === 'AKs');
            else baseHand = range[Math.floor(Math.random() * range.length)];
            
            currentHand = getRandomPalos(baseHand);
            villanoStackSize = Math.random() > 0.8 ? 50 : 100;
            let heroPosIdx = Math.floor(Math.random() * 6);
            let villanoPosIdx;
            do { villanoPosIdx = Math.floor(Math.random() * 6); } while (villanoPosIdx === heroPosIdx);
            
            if (villanoStackSize === 100) {
                // FRECUENCIA AUMENTADA DE NITS (80% si es KK o AKs)
                if ((currentHand.id === 'KK' || currentHand.id === 'AKs') && Math.random() < 0.8) isVillanoNit = true;
                else if (Math.random() < 0.2) isVillanoNit = true;

                currentHBet = (heroPosIdx < villanoPosIdx) ? 24 : 10;
                currentVBet = (heroPosIdx < villanoPosIdx) ? 100 : 24;
                setupUI(heroPosIdx, villanoPosIdx, currentHBet, currentVBet, 100);
                renderButtons('NORMAL');
            } else {
                if (Math.random() > 0.5) { scenarioAction = "push"; currentHBet = 10; currentVBet = 50; renderButtons('NORMAL'); }
                else { scenarioAction = "3bet"; currentHBet = 2; currentVBet = 10; renderButtons('3BET_50'); }
                setupUI(heroPosIdx, villanoPosIdx, currentHBet, currentVBet, 50);
            }
        }
    }

    function setupUI(hPos, vPos, hBet, vBet, vStack) {
        const dealerBtn = document.getElementById('dealer-btn');
        dealerBtn.className = 'dealer-button';
        for (let i = 0; i < 6; i++) {
            const logicalPos = (i + hPos) % 6;
            const pod = document.getElementById(`pod-${i}`);
            pod.dataset.stack = (logicalPos === vPos) ? vStack : 100;
            let currentStack = parseFloat(pod.dataset.stack);
            if (logicalPos === 4) currentStack -= 0.5;
            if (logicalPos === 5) currentStack -= 1.0;
            if (i === 0) {
                pod.querySelector('.name-plate').innerText = `HERO (${posNames[logicalPos]})`;
                pod.classList.add('active-player', 'opacity-100');
                pod.querySelector('.avatar-frame').classList.add('is-hero-frame');
                if (logicalPos !== 4 && logicalPos !== 5) currentStack -= hBet;
                else currentStack = parseFloat(pod.dataset.stack) - hBet;
            } else if (logicalPos === vPos) {
                pod.classList.add('active-player', 'opacity-100');
                pod.querySelector('.card-back-group').style.display = 'flex';
                pod.querySelector('.name-plate').innerText = isVillanoNit ? `${posNames[logicalPos]} (NIT)` : posNames[logicalPos];
                if (logicalPos !== 4 && logicalPos !== 5) currentStack -= vBet;
                else currentStack = parseFloat(pod.dataset.stack) - vBet;
            } else { pod.querySelector('.name-plate').innerText = posNames[logicalPos]; }
            pod.querySelector('.stack-val').innerText = currentStack.toFixed(1) + " BB";
            if (logicalPos === 3) { dealerBtn.classList.add(`d-pos-${i}`); dealerBtn.style.display = 'flex'; }
        }
        let vVisIdx = (vPos - hPos + 6) % 6;
        document.getElementById(`bet-0`).innerText = hBet + " BB";
        document.getElementById(`bet-0`).style.display = 'block';
        document.getElementById(`bet-${vVisIdx}`).innerText = vBet + " BB";
        document.getElementById(`bet-${vVisIdx}`).style.display = 'block';
        if (vBet >= vStack) document.getElementById(`bet-${vVisIdx}`).style.borderColor = "#ef4444";
        document.getElementById('pot-display').innerText = `POT: ${(hBet + vBet + 1.5).toFixed(1)} BB`;
        document.getElementById('hero-cards').innerHTML = `<div class="card ${currentHand.s1}" style="transform:rotate(-5deg)"><span>${currentHand.v1}</span><span class="card-suit">${currentHand.i1}</span></div><div class="card ${currentHand.s2}" style="transform:rotate(5deg)"><span>${currentHand.v2}</span><span class="card-suit">${currentHand.i2}</span></div>`;
    }

    function updateStats(isCorrect) {
        if (isCorrect) { actualHands++; if (actualHands > recordHands) { recordHands = actualHands; localStorage.setItem('poker_record_preflop', recordHands); } }
        else { actualHands = 0; }
        document.getElementById('actual-val').innerText = actualHands;
        document.getElementById('record-val').innerText = recordHands;
    }

    function goToPostflop() {
        const gameData = { hand: currentHand, pot: 30, villanoStack: villanoStackSize, isNit: isVillanoNit };
        localStorage.setItem('pokerGameData', JSON.stringify(gameData));
        window.location.href = 'postflop.html';
    }
    window.onload = generateScenario;
</script>
</body>
</html>


